---
description: 依據互動式或提供的原則輸入，建立或更新專案憲章，並確保所有相依的模板保持同步。
---

使用者輸入可以直接由代理程式提供，或作為命令參數傳入——你**必須**在繼續提示前考慮這些輸入（若非空）。

使用者輸入：

$ARGUMENTS

你正在更新位於 `/memory/constitution.md` 的專案憲章。此檔案為一個模板，內含以方括號標示的占位符（例如：`[PROJECT_NAME]`、`[PRINCIPLE_1_NAME]`）。你的工作是：(a) 收集／推導具體值，(b) 精確填入模板，(c) 將任何修訂同步至所有相依產出物。

請依照以下執行流程操作：

1. 載入現有的憲章模板（位於 `/memory/constitution.md`）。
   - 辨識所有格式為 `[ALL_CAPS_IDENTIFIER]` 的占位符。
   **重要**：使用者可能需要的原則數量比模板中多或少。若有指定數量，請遵循該數量——依照一般模板進行。你需據此更新文件。

2. 收集／推導占位符的具體值：
   - 若使用者輸入（對話內容）有提供值，則直接採用。
   - 否則，從現有的儲存庫內容（如 README、文件、過去版本的憲章（若有嵌入））推導。
   - 關於治理日期：`RATIFICATION_DATE` 為最初通過日期（若未知請詢問或標記 TODO），`LAST_AMENDED_DATE` 若有變更則為今日，否則維持原值。
   - `CONSTITUTION_VERSION` 必須依照語意化版本規則遞增：
     * MAJOR：不相容的治理／原則移除或重新定義。
     * MINOR：新增原則／章節，或大幅擴充指引。
     * PATCH：釐清、措辭、錯字修正、非語意性微調。
   - 若版本遞增類型有疑義，請先提出推論理由再定案。

3. 撰寫更新後的憲章內容：
   - 用具體文字取代所有占位符（除非專案明確選擇暫不定義的模板欄位，否則不得留下方括號占位符——任何保留必須明確說明理由）。
   - 保持標題階層，已取代的註解可移除，除非仍具說明性。
   - 確保每個原則章節包含：簡明名稱、闡述不可協商規則的段落（或條列）、若非顯而易見則需明確說明理由。
   - 確保治理章節列出修訂程序、版本政策與合規審查預期。

4. 一致性同步檢查清單（將舊有清單轉為主動驗證）：
   - 閱讀 `/templates/plan-template.md`，確保所有「Constitution Check」或規則與更新後原則一致。
   - 閱讀 `/templates/spec-template.md`，確認範疇／需求是否一致——若憲章增刪強制章節或約束，需同步更新。
   - 閱讀 `/templates/tasks-template.md`，確保任務分類反映新增或移除的原則驅動任務類型（如可觀察性、版本管理、測試規範）。
   - 閱讀 `/templates/commands/*.md` 內每個命令檔（包含本檔），確認未遺留過時引用（如僅限代理名稱 CLAUDE），若需通用指引則修正。
   - 閱讀所有執行時指引文件（如 `README.md`、`docs/quickstart.md` 或代理專屬指引檔（若有）），更新涉及變動原則的引用。

5. 產生同步影響報告（更新後於憲章檔案頂端以 HTML 註解形式前置）：
   - 版本變更：舊版 → 新版
   - 修改原則清單（若有更名，列出舊標題 → 新標題）
   - 新增章節
   - 移除章節
   - 需更新模板（✅ 已更新 / ⚠ 待處理）及檔案路徑
   - 若有占位符暫緩填寫，列於後續 TODO

6. 輸出前驗證：
   - 不得有未說明的方括號占位符殘留。
   - 版本行與報告一致。
   - 日期採用 ISO 格式 YYYY-MM-DD。
   - 原則需具宣告性、可測試，避免模糊語言（如「should」→ 視情況改為 MUST／SHOULD 並說明理由）。

7. 將完成的憲章覆寫寫回 `/memory/constitution.md`。

8. 向使用者輸出最終摘要，內容包括：
   - 新版本號及遞增理由。
   - 需人工後續處理的檔案。
   - 建議的提交訊息（如 `docs: amend constitution to vX.Y.Z (principle additions + governance update)`）。

格式與風格要求：
- 標題層級必須與模板完全一致（不得升降級）。
- 較長的說明請適度換行以利閱讀（理想上 <100 字），但避免不自然斷行。
- 各章節間僅留一個空白行。
- 避免行尾多餘空白。

若使用者只提供部分更新（如僅修訂一條原則），仍需執行驗證與版本決策步驟。

若關鍵資訊缺失（如通過日期確實未知），請插入 `TODO(<FIELD_NAME>): explanation`，並於同步影響報告的暫緩項目中列出。

請勿建立新模板；僅能操作現有的 `/memory/constitution.md` 檔案。
