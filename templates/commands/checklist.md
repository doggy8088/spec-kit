---
description: 根據用戶需求，為當前功能產生自訂檢查清單。
scripts:
  sh: scripts/bash/check-prerequisites.sh --json
  ps: scripts/powershell/check-prerequisites.ps1 -Json
---

## 檢查清單目的：「英文單元測試」

**關鍵概念**：檢查清單是**需求撰寫的單元測試**——用來驗證特定領域中需求的品質、清晰度與完整性。

**不是用於驗證／測試**：

- ❌ 不是「驗證按鈕是否能正確點擊」
- ❌ 不是「測試錯誤處理是否正常」
- ❌ 不是「確認 API 回傳 200」
- ❌ 不是檢查程式碼／實作是否符合規格

**用於需求品質驗證**：

- ✅「所有卡片類型是否都有定義視覺階層需求？」（完整性）
- ✅「『明顯顯示』是否以具體尺寸／位置量化？」（清晰度）
- ✅「所有互動元素的 hover 狀態需求是否一致？」（一致性）
- ✅「是否有定義鍵盤導覽的無障礙需求？」（覆蓋範圍）
- ✅「規格是否有定義 logo 圖片載入失敗時的處理？」（邊界情境）

**比喻**：如果你的規格像是用英文寫的程式碼，檢查清單就是它的單元測試套件。你是在測試需求是否寫得好、是否完整、明確且可直接實作——而不是測試實作本身是否可用。

## 用戶輸入

```text
$ARGUMENTS
```

你在執行前**必須**考慮用戶輸入（若非空）。

# 執行步驟

## Execution Steps

1. **初始化**：從 repo 根目錄執行 `{SCRIPT}`，並解析 JSON 以取得 FEATURE_DIR 與 AVAILABLE_DOCS 清單。
   - 所有檔案路徑必須為絕對路徑。
   - 若引數中有單引號（如 "I'm Groot"），請使用跳脫語法：例如 `'I'\''m Groot'`（或若可行則用雙引號："I'm Groot"）。

2. **釐清意圖（動態）**：根據上下文產生最多三個初步釐清問題（不得使用預設題庫）。這些問題**必須**：
   - 依據用戶的描述＋從規格/計畫/任務中提取的訊號動態生成
   - 僅詢問會實質影響檢查清單內容的資訊
   - 若在 `$ARGUMENTS` 中已明確，則個別問題可跳過
   - 以精確度優先於廣度

   生成演算法：
   1. 提取訊號：功能領域關鍵字（如 auth、latency、UX、API）、風險指標（如 "critical"、"must"、"compliance"）、利害關係人提示（如 "QA"、"review"、"security team"）、明確交付項（如 "a11y"、"rollback"、"contracts"）。
   2. 將訊號分群為候選重點領域（最多 4 組），依相關性排序。
   3. 若未明確，判斷可能的目標對象與時機（作者、審查者、QA、發佈）。
   4. 偵測缺漏面向：範圍廣度、深度/嚴謹度、風險強調、排除邊界、可衡量的驗收標準。
   5. 依下列問題原型擇一組成問題：
      - 範圍細化（如：「此檢查清單是否需涵蓋與 X、Y 的整合接點，還是僅限於本地模組正確性？」）
      - 風險優先排序（如：「這些潛在風險區塊中，哪些需要強制設置檢查關卡？」）
      - 深度校準（如：「這是 pre-commit 的輕量 sanity list 還是正式發佈的 release gate？」）
      - 目標對象定位（如：「這份檢查清單僅作者自用，還是 PR 審查時同儕也會用？」）
      - 邊界排除（如：「本輪是否明確排除效能調校項目？」）
      - 情境類型缺口（如：「未偵測到復原流程——rollback／部分失敗路徑是否納入範圍？」）

   問題格式規則：
   - 若有選項，請產生精簡表格，欄位：Option | Candidate | Why It Matters
   - 最多僅列 A–E 選項；若開放式回答更清楚則不需表格
   - 絕不要求用戶重述已說過的內容
   - 避免臆測分類（不得憑空想像）。若不確定，請明確詢問：「請確認 X 是否屬於範圍內。」

   若無法互動時的預設值：
   - 深度：標準
   - 目標對象：如與程式碼相關則為 Reviewer（PR），否則為 Author
   - 重點：前兩大相關性分群

   輸出問題時請標示 Q1/Q2/Q3。回覆後：若有兩類以上情境（Alternate／Exception／Recovery／Non-Functional 領域）仍不明確，你**可以**再追問最多兩個精準後續問題（Q4/Q5），每題附一句理由（如：「復原路徑風險未解決」）。總題數不得超過五題。若用戶明確拒絕，則不得繼續追問。

3. **理解用戶需求**：結合 `$ARGUMENTS` 與釐清回覆：
   - 推導檢查清單主題（如 security、review、deploy、ux）
   - 彙整用戶明確指定的 must-have 項目
   - 將重點選擇映射至分類結構
   - 從規格/計畫/任務中推斷缺漏上下文（**不得憑空想像**）

4. **載入功能上下文**：從 FEATURE_DIR 讀取：
   - spec.md：功能需求與範圍
   - plan.md（如有）：技術細節、相依性
   - tasks.md（如有）：實作任務

   **上下文載入策略**：
   - 僅載入與當前重點領域相關的必要部分（避免整份檔案傾倒）
   - 長段落請優先摘要為精簡的情境／需求條列
   - 採漸進式揭露：僅在發現缺口時再補充檢索
   - 若原始文件過大，請產生中繼摘要條目，勿直接嵌入原文

5. **產生檢查清單**－建立「需求單元測試」：
   - 若 `FEATURE_DIR/checklists/` 目錄不存在則建立
   - 產生唯一的檢查清單檔名：
     - 依領域選用簡短、具描述性的名稱（如 `ux.md`、`api.md`、`security.md`）
     - 格式：`[domain].md`
     - 若檔案已存在，則附加於現有檔案
   - 條目依序編號，從 CHK001 開始
   - 每次執行 `/speckit.checklist` 都會建立新檔案（**絕不覆蓋**現有檢查清單）

   **核心原則－測試需求本身，而非實作**：
   每一條檢查清單項目**必須**針對「需求本身」進行檢驗，涵蓋：
   - **完整性**：所有必要需求是否齊全？
   - **明確性**：需求是否明確且具體？
   - **一致性**：需求間是否相互一致？
   - **可衡量性**：需求是否可客觀驗證？
   - **覆蓋性**：所有情境／邊界案例是否涵蓋？

   **分類結構**－依需求品質面向分組：
   - **需求完整性**（所有必要需求是否有文件記載？）
   - **需求明確性**（需求是否具體且無歧義？）
   - **需求一致性**（需求間是否無衝突？）
   - **驗收標準品質**（成功標準是否可衡量？）
   - **情境覆蓋性**（所有流程／案例是否涵蓋？）
   - **邊界案例覆蓋性**（邊界條件是否有定義？）
   - **非功能性需求**（效能、安全性、無障礙等是否有規範？）
   - **相依性與假設**（是否有記錄並驗證？）
   - **歧義與衝突**（哪些地方需再釐清？）

   **如何撰寫檢查清單項目－「英文需求單元測試」**：

   ❌ **錯誤範例**（測試實作）：
   - 「驗證首頁顯示 3 張節目卡片」
   - 「測試桌面版 hover 狀態運作正常」
   - 「確認點擊 logo 可回首頁」

   ✅ **正確範例**（測試需求品質）：
   - 「精選節目的數量與版面配置是否有明確規範？」【完整性】
   - 「『顯著顯示』是否以具體尺寸／位置量化？」【明確性】
   - 「所有互動元件的 hover 狀態需求是否一致？」【一致性】
   - 「所有互動 UI 是否有定義鍵盤導覽需求？」【覆蓋性】
   - 「logo 圖片載入失敗時是否有備援行為規範？」【邊界案例】
   - 「非同步節目資料的 loading 狀態是否有定義？」【完整性】
   - 「規格是否有定義多個 UI 元素的視覺階層？」【明確性】

   **項目結構**：
   每一條目應遵循以下模式：
   - 以「問題」形式詢問需求品質
   - 著重於規格／計畫中「已寫」或「未寫」的內容
   - 在括號中標示品質面向【完整性／明確性／一致性等】
   - 檢查現有需求時引用規格章節 `[Spec §X.Y]`
   - 檢查缺漏需求時使用 `[Gap]` 標記

   **各品質面向範例**：

   完整性：
   - 「所有 API 失敗模式的錯誤處理需求是否有定義？【缺口】」
   - 「所有互動元件是否有無障礙需求規範？【完整性】」
   - 「響應式版面是否有定義行動裝置斷點需求？【缺口】」

   明確性：
   - 「『快速載入』是否以具體時間門檻量化？【明確性，Spec §NFR-2】」
   - 「『相關節目』的選取標準是否有明確定義？【明確性，Spec §FR-5】」
   - 「『顯著』是否以可衡量的視覺屬性定義？【歧義，Spec §FR-4】」

   一致性：
   - 「所有頁面的導覽需求是否一致？【一致性，Spec §FR-10】」
   - 「首頁與詳情頁的卡片元件需求是否一致？【一致性】」

   覆蓋性：
   - 「零資料狀態（無節目）是否有需求定義？【覆蓋性，邊界案例】」
   - 「多用戶同時互動情境是否有涵蓋？【覆蓋性，缺口】」
   - 「部分資料載入失敗時是否有需求規範？【覆蓋性，例外流程】」

   可衡量性：
   - 「視覺階層需求是否可衡量／可測試？【驗收標準，Spec §FR-1】」
   - 「『均衡視覺權重』是否可客觀驗證？【可衡量性，Spec §FR-2】」

   **情境分類與覆蓋性**（聚焦需求品質）：
   - 檢查是否有針對：主要、替代、例外／錯誤、復原、非功能性情境的需求
   - 每類情境都要問：「[情境類型] 的需求是否完整、明確且一致？」
   - 若缺少某類情境：「[情境類型] 的需求是刻意排除還是遺漏？【缺口】」
   - 有狀態變動時請納入韌性／回滾：「遷移失敗時的 rollback 需求是否有定義？【缺口】」

   **可追溯性需求**：
   - 最低要求：80% 以上項目**必須**包含至少一個可追溯性引用
   - 每項目應引用：規格章節 `[Spec §X.Y]`，或使用標記：`[Gap]`、`[Ambiguity]`、`[Conflict]`、`[Assumption]`
   - 若無 ID 系統：「是否有建立需求與驗收標準的 ID 編碼方案？【可追溯性】」

   **顯示並解決問題**（需求品質問題）：
   針對需求本身提出問題：
   - 歧義：「『快速』一詞是否有具體指標量化？【歧義，Spec §NFR-1】」
   - 衝突：「§FR-10 與 §FR-10a 的導覽需求是否衝突？【衝突】」
   - 假設：「『Podcast API 永遠可用』的假設是否有驗證？【假設】」
   - 相依性：「外部 Podcast API 需求是否有記錄？【相依性，缺口】」
   - 定義缺漏：「『視覺階層』是否有具體標準定義？【缺口】」

   **內容整併**：
   - 軟性上限：若原始候選項目超過 40 條，請依風險／影響力排序
   - 合併重複檢查同一需求面的近似條目
   - 若低影響邊界案例超過 5 條，請整併為一項：「需求是否涵蓋 X、Y、Z 等邊界案例？【覆蓋性】」

   **🚫 絕對禁止**－以下會讓檢查清單變成實作測試而非需求測試：
   - ❌ 任何以「Verify」、「Test」、「Confirm」、「Check」＋實作行為開頭的項目
   - ❌ 涉及程式碼執行、用戶操作、系統行為的描述
   - ❌ 「顯示正確」、「運作正常」、「如預期運作」等
   - ❌ 「點擊」、「導覽」、「渲染」、「載入」、「執行」等動詞
   - ❌ 測試案例、測試計畫、QA 程序
   - ❌ 實作細節（如框架、API、演算法）

   **✅ 必須遵循的模式**－這些才是檢查需求品質：
   - ✅ 「[需求類型] 是否有針對 [情境] 定義／規範／記錄？」
   - ✅ 「[模糊詞] 是否以具體標準量化／釐清？」
   - ✅ 「[A 區段] 與 [B 區段] 的需求是否一致？」
   - ✅ 「[需求] 是否可客觀衡量／驗證？」
   - ✅ 「需求是否涵蓋 [邊界案例／情境]？」
   - ✅ 「規格是否有定義 [缺漏面向]？」

6. **結構參考**：依照 `templates/checklist-template.md` 的標準模板產生檢查清單，包括標題、meta 區塊、分類標題與 ID 格式。若無模板，請採用：H1 標題、用途／建立時間 meta 行、`##` 分類區塊，內含`- [ ] CHK### <requirement item>` 條目，ID 全域遞增從 CHK001 起算。

7. **報告**：輸出已建立檢查清單的完整路徑、項目數，並提醒用戶每次執行都會產生新檔案。摘要說明：
   - 選定的重點領域
   - 深度層級
   - 角色／時機
   - 已納入的用戶明確指定 must-have 項目

**重要**：每次執行 `/speckit.checklist` 指令都會以簡短、具描述性的名稱建立檢查清單檔案，除非檔案已存在。這樣可以：

- 建立多種不同類型的檢查清單（如 `ux.md`、`test.md`、`security.md`）
- 檔名簡潔易懂，能直接反映檢查清單用途
- 在 `checklists/` 資料夾中易於辨識與瀏覽

為避免雜亂，請使用具描述性的類型，並於完成後清理過時的檢查清單。

# 檢查清單類型範例與示例項目

## Example Checklist Types & Sample Items

**UX 需求品質檢查清單：** `ux.md`

範例項目（測試需求品質，**非**實作）：

- 「視覺階層需求是否以可衡量標準定義？【明確性，Spec §FR-1】」
- 「UI 元素的數量與位置是否有明確規範？【完整

```markdown
- [ ] CHK001 - Verify landing page displays 3 episode cards [Spec §FR-001]
- [ ] CHK002 - Test hover states work correctly on desktop [Spec §FR-003]
- [ ] CHK003 - Confirm logo click navigates to home page [Spec §FR-010]
- [ ] CHK004 - Check that related episodes section shows 3-5 items [Spec §FR-005]
```

**✅ 正確 - 這些測試需求品質良好：**

```markdown
- [ ] CHK001 - Are the number and layout of featured episodes explicitly specified? [Completeness, Spec §FR-001]
- [ ] CHK002 - Are hover state requirements consistently defined for all interactive elements? [Consistency, Spec §FR-003]
- [ ] CHK003 - Are navigation requirements clear for all clickable brand elements? [Clarity, Spec §FR-010]
- [ ] CHK004 - Is the selection criteria for related episodes documented? [Gap, Spec §FR-005]
- [ ] CHK005 - Are loading state requirements defined for asynchronous episode data? [Gap]
- [ ] CHK006 - Can "visual hierarchy" requirements be objectively measured? [Measurability, Spec §FR-001]
```

**主要差異：**

- 錯誤：測試系統是否正確運作
- 正確：測試需求是否正確撰寫
- 錯誤：行為驗證
- 正確：需求品質驗證
- 錯誤：「它有做 X 嗎？」
- 正確：「X 是否有被明確規範？」
